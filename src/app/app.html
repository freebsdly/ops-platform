<app-route-loading-indicator />

@if (showLayout()) {
  <nz-layout class="app-layout">
    <nz-sider
      class="app-layout-sidebar app-layout-left"
      nzCollapsible
      [nzWidth]="248"
      [nzCollapsedWidth]="48"
      nzBreakbreakpoint="md"
      [nzCollapsed]="isSiderCollapsedSig()"
      (nzCollapsedChange)="storeService.setSiderCollapsed($event)"
      [nzTrigger]="null"
    >
      <app-sider class="app-layout-sider-inner" />
    </nz-sider>
    
    <!-- 折叠按钮放在侧边栏外部，定位在侧边栏右侧 -->
    <app-collapse-button />
    
    <nz-layout class="app-layout-right">
      <nz-header class="app-layout-header">
        <div class="header-left">
          <app-module-selector />
        </div>
        <div class="header-right">
          <app-lang-selector />
          @if (isAuthenticatedSig() && userSig(); as user) {
            <app-user-info 
              [user]="{
                name: user?.name || '',
                email: user?.email || '',
                avatar: user?.avatar || 'https://api.dicebear.com/7.x/avataaars/svg?seed=' + (user?.name || 'user'),
                role: user?.roles?.includes('admin') ? 'Administrator' : 'User'
              }" 
              (onLogout)="storeService.logout()"
            />
          }
        </div>
      </nz-header>
      <nz-content class="app-layout-content">
        <router-outlet></router-outlet>
      </nz-content>
      <nz-footer class="app-layout-footer">
        <p>footer</p>
      </nz-footer>
    </nz-layout>
  </nz-layout>
} @else {
  <router-outlet></router-outlet>
}
