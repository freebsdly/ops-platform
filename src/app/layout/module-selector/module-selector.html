<button
  nz-dropdown
  [nzDropdownMenu]="moduleMenu"
  nzTrigger="hover"
  nzPlacement="bottomRight"
  class="module-selector-trigger"
  aria-label="Module selector"
  aria-haspopup="true"
>
  <span nz-icon [nzType]="currentModuleData()?.icon || 'appstore'" class="module-selector-icon"></span>
</button>

<nz-dropdown-menu #moduleMenu="nzDropdownMenu" class="module-dropdown-menu">
  <div class="module-menu-wrapper">
    <div class="module-menu-content">
      <div class="module-menu-header">
        <span class="module-menu-title">Select Module</span>
      </div>
      <div nz-flex [nzWrap]="'wrap'" [nzGap]="'small'" class="module-flex">
        @for (module of modules(); track module.id) {
          <div nz-flex [nzFlex]="'0 0 calc(25% - 6px)'">
            <button
              class="module-card"
              [class.module-card-selected]="currentModule() === module.id"
              (click)="selectModule(module)"
              [attr.aria-pressed]="currentModule() === module.id"
              [style.--module-color]="module.color"
            >
              <div class="module-card-icon">
                <span nz-icon [nzType]="module.icon" nzTheme="outline"></span>
              </div>
              <div class="module-card-content">
                <span class="module-card-title">{{ module.title }}</span>
              </div>
              @if (currentModule() === module.id) {
                <span nz-icon nzType="check" class="module-card-check"></span>
              }
            </button>
          </div>
        }
      </div>
    </div>
  </div>
</nz-dropdown-menu>
