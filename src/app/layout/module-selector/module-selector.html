<button
  nz-dropdown
  [nzDropdownMenu]="moduleMenu"
  nzTrigger="hover"
  nzPlacement="bottomRight"
  class="module-selector-trigger"
  aria-label="Module selector"
  aria-haspopup="true"
>
  <!-- We'll need to combine data from service with module ID -->
  @if (availableModules$ | async; as modules) {
    @if (currentModule$ | async; as currentModuleId) {
      @for (module of modules; track module.id) {
        @if (module.id === currentModuleId) {
          <span nz-icon [nzType]="module.icon || 'appstore'" class="module-selector-icon"></span>
        }
      }
    } @else {
      <span nz-icon nzType="appstore" class="module-selector-icon"></span>
    }
  } @else {
    <span nz-icon nzType="appstore" class="module-selector-icon"></span>
  }
</button>

<nz-dropdown-menu #moduleMenu="nzDropdownMenu" class="module-dropdown-menu">
  <div class="module-menu-wrapper">
    <div class="module-menu-content">
      <div nz-flex [nzWrap]="'wrap'" [nzGap]="'small'" class="module-flex">
        @if (availableModules$ | async; as modules) {
          @if (currentModule$ | async; as currentModuleId) {
            @for (module of modules; track module.id) {
              <div nz-flex [nzFlex]="'0 0 calc((100% - 24px) / 4)'">
                <button
                  class="module-card"
                  [class.module-card-selected]="module.id === currentModuleId"
                  (click)="selectModule(module.id)"
                  [attr.aria-pressed]="module.id === currentModuleId"
                  [style.--module-color]="module.color"
                >
                  <div class="module-card-icon">
                    <span nz-icon [nzType]="module.icon" nzTheme="outline"></span>
                  </div>
                  <div class="module-card-content">
                    <span class="module-card-title">{{ module.title | translate }}</span>
                  </div>
                  @if (module.id === currentModuleId) {
                    <span nz-icon nzType="check" class="module-card-check"></span>
                  }
                </button>
              </div>
            }
          }
        }
      </div>
    </div>
  </div>
</nz-dropdown-menu>
