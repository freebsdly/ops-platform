<button
  nz-dropdown
  [nzDropdownMenu]="moduleMenu"
  nzTrigger="hover"
  nzPlacement="bottomRight"
  class="module-selector-trigger"
  aria-label="Module selector"
  aria-haspopup="true"
  aria-controls="module-menu"
  id="module-selector-trigger"
>
  <span nz-icon [nzType]="currentModuleIcon()" class="module-selector-icon"></span>
  <span class="module-selector-name">{{ currentModuleName() | translate }}</span>
</button>

<nz-dropdown-menu #moduleMenu="nzDropdownMenu" class="module-dropdown-menu" id="module-menu">
  <div class="module-menu-wrapper">
    <div class="module-menu-content">
      @if (viewModel().length > 0) {
        <div nz-flex [nzWrap]="'wrap'" [nzGap]="'small'" class="module-flex" role="list" aria-label="Available modules">
          @for (module of viewModel(); track trackByModuleId($index, module)) {
            <div nz-flex [nzFlex]="'0 0 calc((100% - 24px) / 4)'" role="listitem">
              <button
                class="module-card"
                [class.module-card-selected]="module.isSelected"
                (click)="selectModule(module.id)"
                (keydown.enter)="selectModule(module.id)"
                (keydown.space)="selectModule(module.id); $event.preventDefault()"
                [attr.aria-pressed]="module.isSelected"
                [attr.aria-label]="module.title"
                [style.--module-color]="module.color"
                tabindex="0"
              >
                <div class="module-card-icon">
                  <span nz-icon [nzType]="module.icon" nzTheme="outline"></span>
                </div>
                <div class="module-card-content">
                  <span class="module-card-title">{{ module.title | translate }}</span>
                </div>
                @if (module.isSelected) {
                  <span nz-icon nzType="check" class="module-card-check" aria-hidden="true"></span>
                }
              </button>
            </div>
          }
        </div>
      } @else {
        <div class="module-menu-empty">
          <span nz-icon nzType="exclamation-circle" class="module-menu-empty-icon"></span>
          <p class="module-menu-empty-text">{{ 'layout.modules.noModulesAvailable' | translate }}</p>
        </div>
      }
    </div>
  </div>
</nz-dropdown-menu>